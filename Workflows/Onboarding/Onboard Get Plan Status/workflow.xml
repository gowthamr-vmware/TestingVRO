<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item4" object-name="workflow:name=generic" id="5b1b7a3f-9ced-4e16-85eb-f3176276995b" version="1.0.0" api-version="6.0.0" allowed-operations="vef" editor-version="2.0" restartMode="1" resumeFromFailedMode="0"><display-name><![CDATA[Onboard Get Plan Status]]></display-name><description><![CDATA[CREATED, STARTED, FINISHED, FAILED, CANCELLED]]></description><position y="50.0" x="100.0"/><input><param name="vraURL" type="string"/><param name="username" type="string"/><param name="password" type="SecureString"/><param name="planID" type="string"/><param name="inputSessionToken" type="string"/></input><output><param name="planStatus" type="string"/></output><attrib name="token1" type="string" read-only="false"><value encoded="n"/></attrib><attrib name="sessionToken" type="string" read-only="false"><value encoded="n"/></attrib><workflow-item name="item0" type="end" end-mode="0"><in-binding/><position y="150.0" x="400.0"/></workflow-item><workflow-item name="item3" out-name="item0" type="task"><display-name><![CDATA[Get Plan Status]]></display-name><script encoded="false"><![CDATA[var opUrl = '/relocation/api/wo/execute-plan/' + planID;
//var opUrl = '/relocation/onboarding/plan/' + planID
var baseUrl = vraURL;
var opMethod = 'GET'
var urlParamValues = null;
var headers = new Properties();
headers.put('Authorization','Bearer ' + sessionToken);
var contentType = null;
var content = null;
var username = null;
var password = null;

response = System.getModule("com.vmware.pso.rest").executeTransientRESTOperation(baseUrl,username,password,opMethod,opUrl,urlParamValues,headers,contentType,content);

System.log('statusCode' + response.statusCode)
System.log('responseString' + response.responseString)

if (response.statusCode != 200) {
    throw 'Exception seen while reading status for plan.  Status code ' + respnose.statusCode;
}

var jsonObj = JSON.parse(response.responseString)

planStatus = jsonObj.taskInfo.stage;
//CREATED, STARTED, FINISHED, FAILED, CANCELLED]]></script><in-binding><bind name="vraURL" type="string" export-name="vraURL"/><bind name="sessionToken" type="string" export-name="sessionToken"/><bind name="planID" type="string" export-name="planID"/></in-binding><out-binding><bind name="planStatus" type="string" export-name="planStatus"/></out-binding><description><![CDATA[Simple task with custom script capability.]]></description><position y="60.0" x="360.0"/></workflow-item><workflow-item name="item4" out-name="item3" type="link" linked-workflow-id="3f40bb50-7b54-4735-bfd5-74412624256a"><display-name><![CDATA[Workflow element]]></display-name><in-binding><bind name="vraURL" type="string" export-name="vraURL"/><bind name="username" type="string" export-name="username"/><bind name="password" type="SecureString" export-name="password"/><bind name="inputSessionToken" type="string" export-name="inputSessionToken"/></in-binding><out-binding><bind name="sessionToken" type="string" export-name="sessionToken"/></out-binding><description><![CDATA[]]></description><position y="60.0" x="200.0"/></workflow-item><presentation/></workflow>