<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item1" object-name="workflow:name=generic" id="b295f005-dc7e-4665-ab70-5ee03ae3b842" version="1.0.0" api-version="6.0.0" allowed-operations="vef" editor-version="2.0" restartMode="1" resumeFromFailedMode="0"><display-name><![CDATA[Add Machines To Plan]]></display-name><position y="50.0" x="100.0"/><input><param name="inputSessionToken" type="string"/><param name="vraURL" type="string"/><param name="username" type="string"/><param name="password" type="SecureString"/><param name="planID" type="string"/><param name="machineIDs" type="Array/string"/><param name="vmNames" type="Array/string"/></input><attrib name="sessionToken" type="string" read-only="false"><value encoded="n"/></attrib><workflow-item name="item0" type="end" end-mode="0"><in-binding/><position y="50.0" x="540.0"/></workflow-item><workflow-item name="item1" out-name="item2" type="link" linked-workflow-id="3f40bb50-7b54-4735-bfd5-74412624256a"><display-name><![CDATA[Workflow element]]></display-name><in-binding><bind name="vraURL" type="string" export-name="vraURL"/><bind name="username" type="string" export-name="username"/><bind name="password" type="SecureString" export-name="password"/><bind name="inputSessionToken" type="string" export-name="inputSessionToken"/></in-binding><out-binding><bind name="sessionToken" type="string" export-name="sessionToken"/></out-binding><description><![CDATA[]]></description><position y="60.0" x="180.0"/></workflow-item><workflow-item name="item2" out-name="item0" type="task"><display-name><![CDATA[Update Plan]]></display-name><script encoded="false"><![CDATA[//var opUrl = '/iaas/api/machines?skip=10';
//var opUrl = '/relocation/onboarding/plan/77b214fa-adbe-4d2d-9f0f-1c41ea88f99a'
//var opUrl = '/iaas/api/machines?expand&$filter=((type%20eq%20%27VM_GUEST%27)%20and%20(name%20eq%20%27*adam*%27))&$orderby=name%20asc&$top=20&$skip=0'
//var opUrl = '/relocation/onboarding/resource'
//var opUrl =  '/relocation/onboarding/rule/6ed4f282-71e8-4940-92d6-206ad1f459b9';
var opUrl = 'relocation/onboarding/task/create-deployment-bulk'
var baseUrl = vraURL;
var opMethod = 'POST'
var urlParamValues = null;
var headers = new Properties();
headers.put('Authorization','Bearer ' + sessionToken);
var contentType = 'application/json';

var contentObj = new Object();
contentObj.planLink = '/relocation/onboarding/plan/' + planID;
contentObj.deployments = new Array();

for (var i=0; i < machineIDs.length; i++) {
    var id = machineIDs[i];
    var vmName = vmNames[i];
    var aDeployment = new Object();
    var resources = new Array();
    aDeployment.resources = resources;

    contentObj.deployments.push(aDeployment);

    var obj = new Object();
    obj.link = '/resources/compute/' + id;
    obj.name = vmName;
    //var tagLinks = new Array();//added
    //obj.tagLinks = tagLinks;//added
    //tagLinks[0] = '/resources/tags/0e22c7d0-fc2b-340f-b5fc-6011ca3b38b2'//added
    resources[0] = obj;
}

var content = JSON.stringify(contentObj);
System.log('Content ' + content);
var username = null;
var password = null;

response = System.getModule("com.vmware.pso.rest").executeTransientRESTOperation(baseUrl,username,password,opMethod,opUrl,urlParamValues,headers,contentType,content);

//var jsonObj = JSON.parse(response.responseString)
System.log('responseString' + response.responseString)
System.log('statusCode' + response.statusCode)

if (response.statusCode == 200) {
   foundMachines = response.responseString;
} else {
    throw 'Problem while retrieving machines.  Status code ' + response.statusCode
}]]></script><in-binding><bind name="vraURL" type="string" export-name="vraURL"/><bind name="sessionToken" type="string" export-name="sessionToken"/><bind name="planID" type="string" export-name="planID"/><bind name="machineIDs" type="Array/string" export-name="machineIDs"/><bind name="vmNames" type="Array/string" export-name="vmNames"/></in-binding><out-binding/><description><![CDATA[Simple task with custom script capability.]]></description><position y="60.0" x="320.0"/></workflow-item><presentation/></workflow>