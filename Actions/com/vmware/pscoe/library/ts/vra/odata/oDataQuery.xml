<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="oDataQuery" result-type="Any" api-version="6.0.0" id="9c1b4cc7-0b28-4a07-8249-ed5dd325474a" version="8.8.223597" allowed-operations="vef" category-name="com.vmware.pscoe.library.ts.vra.odata">
  <script encoded="false"><![CDATA[var __global = System.getContext() || (function () {
    return this;
}).call(null);
var VROES = __global.__VROES || (__global.__VROES = System.getModule("com.vmware.pscoe.library.ecmascript").VROES()), tslib_1 = VROES.tslib, exports = {};
var oDataOperation_1 = VROES.importLazy("com.vmware.pscoe.library.ts.vra.odata.oDataOperation");
var ODataQuery = /** @class */ (function (_super) {
    tslib_1.__extends(ODataQuery, _super);
    function ODataQuery(_service, entityKey, params) {
        if (params === void 0) { params = {}; }
        var _this = _super.call(this, _service, params) || this;
        _this._service = _service;
        _this.entityKey = entityKey;
        _this.params = params;
        _this._entitiesUri = entityKey;
        return _this;
    }
    ODataQuery.prototype.filter = function (filter) {
        if (filter) {
            this._filter = filter;
        }
        return this;
    };
    ODataQuery.prototype.exec = function () {
        if (this._service[this._entitiesUri]) {
            var params = this.getQueryParams();
            var response = this._service[this._entitiesUri](params);
            return _super.prototype.handleResponse.call(this, response);
        }
        else {
            throw new Error("There is no such entity: " + this._entitiesUri);
        }
    };
    ODataQuery.prototype.execPaginatedRequest = function () {
        if (this._service[this._entitiesUri]) {
            var params = this.getQueryParams();
            var response = this._service[this._entitiesUri](params);
            var data = _super.prototype.handleResponse.call(this, response);
            var tempResponse = null;
            var tempData = null;
            var top = data['content'].length;
            while (data['totalElements'] > data['content'].length) {
                params['query_$top'] = top;
                params['query_$skip'] = data['content'].length;
                tempResponse = this._service[this._entitiesUri](params);
                tempData = _super.prototype.handleResponse.call(this, tempResponse);
                data['content'] = data['content'].concat(tempData['content']);
            }
            return _super.prototype.handleResponse.call(this, response);
        }
        else {
            throw new Error("There is no such entity: " + this._entitiesUri);
        }
    };
    ODataQuery.prototype.getQueryParams = function () {
        var params = this._params;
        if (this._filter) {
            params['query_$filter'] = this._filter;
        }
        return params;
    };
    return ODataQuery;
}(oDataOperation_1._.ODataOperation));
exports.ODataQuery = ODataQuery;
return exports;]]></script>
</dunes-script-module>